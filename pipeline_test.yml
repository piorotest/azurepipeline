variables:
   URL_SHELL: $(URL)
   API_KEY_SHELL: $(API_KEY)
   PIPENAME_SHELL: $(Build.BuildNumber)

pool:
  name: Azure Pipelines

resources:
  repositories:
  - repository: templates
    type: git
    name: pipeline_test/pipeline_test
    ref: refs/heads/main


extends: 
  template: pipedb_runtest.yml@templates
  parameters:
    usersteps:

    - task: Bash@3
      inputs:
        targetType: 'inline'
        script: |
          ls -lR $(Build.SourcesDirectory)

    - task: Bash@3
      inputs:
        targetType: 'inline'
        script: |
              DBNAME="pipedb_$(PIPENAME_SHELL)"
              export DBNAME=${DBNAME/./}
              docker run -v $(Build.SourcesDirectory)/azurepipeline/schema:/liquibase/changelog liquibase/liquibase:latest --changeLogFile changelog/main.xml --url "jdbc:sqlserver://uvo1sflnv1auw79mvq4.vm.cld.sr;Port=1434;DatabaseName=$DBNAME;encrypt=true;trustServerCertificate=true" --username lb --password lb  update
      displayName: Deploy code

    - task: Bash@3
      inputs:
        targetType: 'inline'
        script: |
          echo "placeholder"
          exit 1
      displayName: Run destrictive test

